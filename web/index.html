<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>YouTube to MP3</title>
	<style>
		body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.4;padding:24px;background:#0b1020;color:#e6e8f2}
		.card{max-width:720px;margin:0 auto;background:#121735;border:1px solid #232a4a;border-radius:14px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,0.35)}
		input[type=url]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #2a335c;background:#0f1430;color:#e6e8f2}
		button{margin-top:12px;padding:12px 16px;border:0;border-radius:10px;background:#5b8cff;color:#fff;font-weight:600;cursor:pointer}
		button:disabled{opacity:.6;cursor:not-allowed}
		.small{opacity:.75;font-size:.9rem}
		footer{margin-top:18px;opacity:.7}
		.notice{background:#1b2145;border:1px solid #2e3a78;border-radius:10px;padding:10px;margin-top:12px}
	</style>
</head>
<body>
	<div class="card">
		<h2>Private YouTube → MP3</h2>
		<p class="small">Run your own backend. Only download content you’re allowed to.</p>
		<input id="url" type="url" placeholder="Paste YouTube URL…" />
		<button id="btn">Download MP3</button>
		<div class="notice small">If this is deployed publicly, add rate limits and auth. Public YouTube‑to‑MP3 APIs are unstable; this is self‑hosted.</div>
		<footer class="small">Backend: FastAPI + yt‑dlp + ffmpeg</footer>
	</div>
	<script>
	const btn = document.getElementById('btn');
	const input = document.getElementById('url');
	btn.addEventListener('click', async () => {
		const url = input.value.trim();
		if (!url) { alert('Please paste a YouTube URL.'); return; }
		btn.disabled = true; btn.textContent = 'Converting…';
		try {
			const resp = await fetch(`/api/download?url=${encodeURIComponent(url)}`);
			if (!resp.ok) {
				const text = await resp.text();
				throw new Error(text || `Request failed: ${resp.status}`);
			}
			const blob = await resp.blob();
			const disposition = resp.headers.get('Content-Disposition') || 'attachment; filename="audio.mp3"';
			const match = disposition.match(/filename="?([^";]+)"?/i);
			const filename = match ? match[1] : 'audio.mp3';
			const link = document.createElement('a');
			link.href = URL.createObjectURL(blob);
			link.download = filename;
			document.body.appendChild(link);
			link.click();
			link.remove();
		} catch (e) {
			alert('Error: ' + (e && e.message ? e.message : e));
		} finally {
			btn.disabled = false; btn.textContent = 'Download MP3';
		}
	});
	</script>
</body>
</html>